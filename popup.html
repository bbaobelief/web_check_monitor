<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Content Monitor</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>网页监控</h1>
            <div style="display: flex; gap: 8px;">
                <button id="exportBtn" class="icon-btn" title="Export Config">
                    <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </button>
                <button id="importBtn" class="icon-btn" title="Import Config">
                    <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                </button>
                <input type="file" id="importFile" accept=".json" style="display: none;">
                <button id="testNotifyBtn" class="icon-btn" title="Test Notification">
                    <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                </button>
                <button id="addTaskBtn" class="icon-btn" title="Add Task">
                    <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
            </div>
        </header>

        <div id="taskList" class="view active">
            <!-- Tasks will be injected here -->
            <div class="empty-state">No tasks yet. Click + to add one.</div>
        </div>

        <div id="addTaskView" class="view hidden">
            <div class="view-header">
                <button id="cancelAddBtn" class="text-btn">Cancel</button>
                <h2>Add Task</h2>
                <button id="saveTaskBtn" class="primary-btn">Save</button>
            </div>
            <form id="addTaskForm">
                <div class="form-group">
                    <label for="taskName">Name</label>
                    <input type="text" id="taskName" placeholder="e.g., Price Monitor" required>
                </div>
                <div class="form-group">
                    <label for="taskUrl">URL</label>
                    <input type="url" id="taskUrl" placeholder="https://example.com" required>
                </div>
                <div class="form-group">
                    <label>Method</label>
                    <div class="radio-group">
                        <label><input type="radio" name="method" value="browser" checked> DOM Text</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="taskSelector">Selector (CSS)</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="taskSelector" placeholder="e.g., #price or .content" required
                            style="flex: 1;">
                        <button type="button" id="testConnectionBtn" class="action-btn">Test</button>
                    </div>
                    <small>CSS Selector to target the content.</small>
                    <div id="testResult" style="margin-top: 4px; font-size: 12px; display: none;"></div>
                </div>
                <div class="form-group">
                    <label for="taskWebhook">WeChat Work Webhook (Optional)</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="url" id="taskWebhook"
                            placeholder="https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=..." style="flex: 1;">
                        <button type="button" id="testWebhookBtn" class="action-btn">Test</button>
                    </div>
                    <div id="webhookTestResult" style="margin-top: 4px; font-size: 12px; display: none;"></div>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                        <input type="checkbox" id="taskBrowserNotify" checked> Enable Browser Notification
                    </label>
                </div>
                <div class="form-group">
                    <label>Notification Rule</label>
                    <select id="taskRuleType" style="width: 100%; padding: 8px; margin-bottom: 8px;">
                        <option value="change">Notify on Change (Default)</option>
                        <option value="always">Always Notify</option>
                        <option value="contains">Contains Keyword</option>
                        <option value="not_contains">Does Not Contain Keyword</option>
                        <option value="regex">Regex Match</option>
                        <option value="gt">Numeric > </option>
                        <option value="lt">Numeric < </option>
                    </select>
                    <input type="text" id="taskRuleValue" placeholder="Keyword, Regex, or Number"
                        style="display: none;">
                </div>
                <div class="form-group">
                    <label>Custom Messages (Optional)</label>
                    <input type="text" id="taskMatchMsg" placeholder="Message when matched (e.g. In Stock!)"
                        style="margin-bottom: 8px;">
                    <input type="text" id="taskNoMatchMsg" placeholder="Message when NOT matched (e.g. Out of Stock)">
                </div>
                <div class="form-group">
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <label for="taskInterval">Interval (minutes)</label>
                            <input type="number" id="taskInterval" value="60" min="1" required>
                        </div>
                        <div style="flex: 1;">
                            <label for="taskTimeout">Timeout (seconds)</label>
                            <input type="number" id="taskTimeout" value="30" min="5" required>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script src="popup.js"></script>
</body>

</html>